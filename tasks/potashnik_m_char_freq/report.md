# Подсчет частоты символа в строке

- Student: Поташник Максим Ярославович, group 3823Б1ФИ3
- Technology: SEQ | MPI
- Variant: 23

## 1. Introduction

Подсчет частоты символа в строке является часто встречающейся операцией во многих задачах, от чего возникает необходимость в ускорении процесса его выполнения.

Ожидается, что при использовании технологии mpi произойдёт ускорение по сравнению с последовательной версией.

## 2. Problem statement

Нужно подсчитать число вхождений символа в строку.

### Входные данные:
Строка произвольной длины и символ.

### Выходные данные:
Одно целое неотрицательное число - число вхождений символа в строку.

### 3. Baseline Algorithm (Sequential)

Заведём переменную для подсчёта числа вхождений, инициализируем её нулём. После этого последовательно проходим по строке, и каждый раз встречая искомый символ, увеличиваем переменную на 1.

### 4. Parallelization Scheme

В процессе с рангом 0 распределяем данные:
Делим строку нацело на столько блоков, сколько выполняется процессов. Может оказаться, что несколько символов останутся не распределёнными (при невозможности деления нацело). Тогда считаем остаток и распределяем его по блокам. Отправляем блоки на другие процессы. 

После этого каждый процесс считает промежуточный результат для выделенного ему блока. В конце работы всех процессов, промежуточные результаты всех процессов складываются с помощью функции MPI_Allreduce и записываются в ответ.

### 5. Experimental Setup

- Hardware/OS: 12th gen Intel(R) Core(TM) i5-12450H, 8 ядер, 16 GB RAM, Windows 11 x64
- Toolchain: compiler, version, build type (Release/RelWithDebInfo)
    - Cmake 3.28.3
    - Компилятор: g++ (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0
    - Использовался Docker-контейнер.
    - Режим сборки: Release.
- Data: Для замера производительности использовалась строка размером 100.000.000, генерируемая из произвольных символов детерминированно (При одинаковых условиях генерируются одинаковые строки для корректности perf тестов). 

## 6. Results and Discussion

### 6.1 Correctness
Корректность работы проверена с помощью тестов Google Test на строках размерами: 1, 5, 10, 20, 100, 1000, 2000, 5000, 10000, 20000.

### 6.2 Performance
| Mode        | Count | Time, s | Speedup | Efficiency |
|-------------|-------|---------|---------|------------|
| seq         | 1     | 0.068   | 1.00    | N/A        |
| mpi         | 2     | 0.168   | 0.40    | 20.0%      |
| mpi         | 4     | 0.149   | 0.45    | 11.25%     |

## 7. Conclusions

Из-за накладных расходов на распределение данных между процессами, работа mpi версии медленне, чем работа последовательной версии. Это обосновывается тем, что только на рассыл строки размером n по процессам уходит n операций по работе с памятью, что уже будет работать дольше, чем seq версия программы.

## 8. References

1. "Параллельное программирование для кластерных систем" ННГУ им. Лобачевского, ИИТММ