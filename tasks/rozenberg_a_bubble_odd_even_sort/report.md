# Параллельная сортировка пузырьком (Четно-нечетная перестановка)

- Студент: Розенберг Алексей Светославович, группа 3823Б1ФИ2
- Технология: SEQ | MPI
- Вариант: 21

## 1. Введение

В данной работе рассматривается классическая задача сортировки данных методом пузырька и её параллельная модификация — алгоритм четно-нечетной перестановки (Odd-Even Sort). Цель — реализовать устойчивую сортировку, способную работать в распределенной среде, и оценить эффективность межпроцессного обмена данными.

Сортировка пузырьком проста в реализации, а её параллельный вариант позволяет эффективно использовать топологию линейной цепочки процессоров, что актуально для специализированных вычислительных систем.

## 2. Постановка задачи

**Дано:**

* Одномерный массив (вектор) $A={a_0,a_1,...,a_(N-1)}, состоящий из $N$ целых чисел.
* Вычислительная система, состоящая из $P$ независимых MPI-процессов, каждый из которых обладает собственной локальной памятью.

**Требуется:**

1. Разбить исходный массив $A$ на $P$ блоков (подмассивов) $A_(local_p) так, чтобы каждый процесс  оперировал своей частью данных.
2. Преобразовать массив $A$ в состояние $A'$, где выполняется условие глобальной упорядоченности:
```math
\forall i, j: (0 \le i < j < N) \implies (a'_i \le a'_j)
```
3. В процессе выполнения алгоритма использовать схему итерационного обмена данными между соседними процессами (с четными и нечетными рангами) по принципу «сравнение-разделение» (Compare-and-Split).

**Ожидаемый результат:**
По завершении работы алгоритма совокупность локальных массивов всех процессов должна представлять собой монотонно неубывающую последовательность, при этом для любых двух процессов с рангами  и  должно выполняться условие:
```math
\max(A_{local\_p}) \le \min(A_{local\_p+1})
```

## 3. Описание алгоритма (Последовательный)

Стандартный алгоритм пузырька:

1. Выполняется $N-1$ итерация внешнего цикла.
2. Во внутреннем цикле сравниваются соседние элементы $A[j]$ и $A[j+1]$.
3. Если $A[j] > A[j+1]$, они меняются местами.
4. Алгоритм может быть оптимизирован флагом проверки наличия обменов для досрочного завершения.

Асимптотическая сложность: $O(N^2)$.

## 4. Схема распараллеливания

### MPI-вариант (Odd-Even Sort)
Используется блочная четно-нечетная сортировка

1. **Локальный этап:** 
* Каждый процесс получает свою часть массива.
* Каждый процесс сортирует свой блок пузырьковым методом.
2. **Глобальный этап (Итерации):** 
* Выполняется $P$ итераций (где $P$ — число процессов).
* В четные итерации процессы с парами рангов (0,1), (2,3) обмениваются данными.
* В нечетные итерации обмениваются пары (1,2), (3,4).
3. **Процедура обмена (Compare-and-Split):**
* Процессы обмениваются блоками данных.
* Выполняется слияние (merge) двух блоков.
* Процесс с меньшим рангом оставляет себе первую (меньшую) половину объединенного массива, процесс с большим рангом — вторую (большую).

## 5. Детали имплементации

* **Обмен данными:** Использование `MPI_Sendrecv` для исключения взаимных блокировок при обмене.
* **Cлияние блоков:** Использование `std::ranges::merge` для объединения локального и полученного блоков.
* **Распределение:** Количество итераций фиксировано и равно числу процессов для гарантии полной сортировки.

### Пограничные случаи
* Количество процессов равно 1 (сводится к последовательному вызову).
* Массив уже отсортирован или отсортирован в обратном порядке.
* Неравномерное распределение элементов (последний процесс имеет меньше данных).

## 6. Экспериментальное окружение
- Аппаратное обеспечение/ОС: AMD Ryzen 7 7800X3D, 8 cores/16 threads, RAM 32 GB 6000 MHz, Windows 11 Home
- Toolchain: MSVC v143, Release
- Настройки окружения: PPC_NUM_THREADS 16 / PPC_NUM_PROC 8
- Данные: массив размером 50000 элементов, элементы сгенерированы случайным образом

## 7. Экспериментальные результаты

### 7.1 Корректность

Корректность проверялась:

* Сравнением итогового массива с результатом системной функции сортировки.
* Проверкой условия $A[i] \le A[i+1]$ по всему глобальному массиву после сбора данных.

Все тесты пройдены успешно.

### 7.2 Производительность

| Mode        | Count | Time, s      | Speedup | Efficiency |
|-------------|-------|--------------|---------|------------|
| seq         | 1     | 1.28689320   | 1.00    | N/A        |
| mpi         | 2     | 0.31278240   | 4.11    | 205.5%     |
| mpi         | 4     | 0.08253544   | 15.59   | 389.8%     |
| mpi         | 8     | 0.02662560   | 48.33   | 604.2%     |
| mpi         | 16    | 0.01116278   | 115.28  | 720.5%     |

## 8. Выводы

В рамках работы была реализована параллельная версия сортировки пузырьком по схеме четно-нечетной перестановки (Odd-Even Sort). На основе полученных результатов можно сделать следующие выводы:
* **Наблюдается суперлинейное ускорение:** Эффективность алгоритма значительно превышает 100%, достигая 720.5% на 16 процессах. Это обусловлено тем, что при разделении массива на мелкие блоки данные начинают полностью помещаться в кэш-память процессора (L1/L2), что радикально снижает задержки доступа к памяти по сравнению с последовательной версией.
* **Изменение вычислительной сложности:** Переход от последовательной сортировки пузырьком со сложностью $O(N^2)$ к схеме, где каждый процесс сначала выполняет быструю локальную сортировку ($O(n \log n)$), а затем лишь фиксированное количество итераций обмена, обеспечивает колоссальный выигрыш в производительности.
* **Высокая масштабируемость:** Несмотря на рост затрат на межпроцессорные коммуникации (`MPI_Sendrecv`), выигрыш от параллельной обработки и кэш-эффектов на данном объеме данных доминирует, позволяя достичь ускорения в 115 раз на 16 процессах.
* **Эффективность распределения:** Блочная схема разбиения данных и использование стратегии «сравнение-разделение» доказали свою состоятельность для решения задач сортировки в распределенных системах.

## 9. Источники

1. [Microsoft MPI Reference](https://learn.microsoft.com/en-us/message-passing-interface/mpi-reference)
2. [C++ Reference (std::ranges::merge)](https://en.cppreference.com/w/cpp/algorithm/ranges/merge.html)
3. [Python Documentation](https://docs.python.org/3/index.html)
4. [Документация по курсу «Параллельное программирование»](https://learning-process.github.io/parallel_programming_course/ru/index.html)
5. Курс лекций и практик по параллельному программированию, ННГУ.