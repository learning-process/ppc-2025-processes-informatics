# <Решетка-тор>

- Student: Лукин Иван Антонович, group 3823Б1ФИ3
- Technology: SEQ | MPI 
- Variant: 9

## 1. Introduction
Мотивация: Исследовать эффективность параллельной маршрутизации сообщений в топологии "тор" с использованием MPI.

Проблема: Маршрутизация сообщений в распределенных системах с топологией "тор" требует эффективных алгоритмов для определения оптимальных путей с учетом циклической природы связей.

Ожидаемый результат: MPI-версия алгоритма маршрутизации позволит эффективно передавать сообщения между любыми узлами в топологии "тор", но может иметь накладные расходы на коммуникацию при работе с большими сообщениями.

## 2. Problem Statement
На вход поступают:

- Номер начального процесса-отправителя

- Номер конечного процесса-получателя

- Вектор сообщения произвольного размера

Задача: Передать сообщение от отправителя к получателю через промежуточные узлы в топологии "тор", сформировав оптимальный маршрут и доставив сообщение без искажений.

## 3. Baseline Algorithm (Sequential)
В SEQ-версии реализована заглушка, которая не выполняет фактической маршрутизации, так как последовательная реализация не имеет смысла для задачи распределенной маршрутизации в топологии "тор". SEQ-версия используется только для корректного прохождения CI.

## 4. Parallelization Scheme
Параллельный алгоритм реализует динамическую маршрутизацию сообщений в топологии "тор" с использованием MPI. Каждый процесс вычисляет свои координаты в двумерной сетке, определяет соседей (верхний, нижний, левый, правый) с учетом циклических границ тора. Начальный процесс-отправитель последовательно определяет направление к получателю, вычисляя кратчайший путь с учетом возможности обхода через границы тора. На каждом шаге сообщение передается соседнему процессу в выбранном направлении с помощью парных операций `MPI_Send` и `MPI_Recv`, при этом текущий узел добавляется в растущий маршрут. Процесс повторяется, пока сообщение не достигнет конечного получателя. Получатель финализирует маршрут, добавляя себя, и рассылает итоговый маршрут и само сообщение всем процессам с использованием коллективных операций `MPI_Bcast` для обеспечения консистентности данных. Алгоритм включает обработку граничных случаев: когда отправитель и получатель совпадают или когда количество процессов равно единице, в этих случаях маршрутизация не требуется. Для определения оптимального направления используется эвристика, сравнивающая абсолютные смещения по осям с учетом цикличности: если смещение по какой-либо оси превышает половину размера сетки, выбирается противоположное направление через границу тора, что минимизирует количество передаточных хопов.

## 5. Experimental Setup
- Hardware/OS: Intel I5-13420H, 8 cores, 16GB RAM, Win10 OS
- Toolchain: Microsoft Visual C++ (MSVC), MSBuild 17.14.23, Release
- Environment: PPC_NUM_PROC
- Data: Вектор на 10'000'000 элементов.

## 6. Results and Discussion

### 6.1 Correctness
Корректность реализации проверена комплексными функциональными тестами, которые охватывают все основные сценарии:

- Отправка сообщения самому себе

- Отправка соседним процессам (правый, левый, верхний, нижний)

- Отправка через циклические границы тора

- Работа с разным количеством процессов (от 1 до 4)

Все тесты успешно проходят, подтверждая правильность алгоритма маршрутизации и передачи данных.

### 6.2 Performance
Анализ производительности в данном контексте не является релевантным по следующим причинам:

1) Некорректность сравнения: SEQ-версия является заглушкой и не выполняет фактическую маршрутизацию, поэтому прямое сравнение времени выполнения с MPI-версией лишено смысла.

2) Специфика задачи: Задача маршрутизации в распределенной топологии по своей природе является параллельной. Последовательная реализация не может адекватно моделировать поведение распределенной системы с независимыми процессами.

3) Тестовые ограничения: Функциональные тесты выполняются на небольшом количестве процессов (до 4), что недостаточно для анализа масштабируемости. Это является ограничением не алгоритма, а тестовой системы.

Вместо анализа производительности следует сосредоточиться на корректности работы алгоритма в различных сценариях, что и было выполнено в разделе 6.1.
## 7. Conclusions
Реализация алгоритма маршрутизации в топологии "тор" с использованием MPI продемонстрировала свою корректность и работоспособность. Алгоритм успешно обрабатывает все базовые сценарии передачи сообщений, включая граничные случаи и работу с циклическими границами топологии.

Основным ограничением исследования является отсутствие анализа масштабируемости на большом количестве процессов, что обусловлено тестовыми ограничениями CI-среды.
## 8. References
1. Лекции по параллельному программированию ННГУ
2. Стандарт MPI