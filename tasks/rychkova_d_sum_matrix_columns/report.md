# Отчёт по лабораторной работе  
## Тема: Сумма элементов матрицы по столбцам

### Автор
Рычкова Диана

---

## 1. Постановка задачи

Требуется реализовать вычисление суммы элементов матрицы по каждому столбцу.  
Для входной целочисленной матрицы размера `N × M` необходимо получить вектор длины `M`, где каждый элемент равен сумме соответствующего столбца матрицы.

Задача должна быть реализована:
- в **последовательном (SEQ)** варианте;
- в **параллельном (MPI)** варианте с использованием библиотеки MPI.

Также необходимо обеспечить:
- валидацию входных данных;
- корректную работу на граничных случаях;
- функциональное и производительное тестирование.

---

## 2. Формат входных и выходных данных

- **Входные данные (InType):**  
  `std::vector<std::vector<int>>` — двумерная матрица целых чисел.

- **Выходные данные (OutType):**  
  `std::vector<int>` — вектор сумм по столбцам.

---

## 3. Ограничения и условия корректности

Матрица считается **корректной**, если:
- она может быть пустой;
- все строки имеют одинаковое количество столбцов.

Матрица считается **некорректной**, если:
- количество элементов в строках различается.

Для некорректной матрицы метод `Validation()` должен возвращать `false`.

---

## 4. Последовательная реализация (SEQ)

### 4.1 Валидация
- Проверяется, что все строки матрицы имеют одинаковую длину.
- Проверяется, что выходной вектор на момент валидации пуст.

### 4.2 Предобработка
- Если матрица пустая — выходной вектор очищается.
- В противном случае выходной вектор инициализируется нулями по числу столбцов.

### 4.3 Основной алгоритм
Последовательно:
- перебираются все строки матрицы;
- значения элементов прибавляются к соответствующему элементу выходного вектора.

### 4.4 Постобработка
- Не требует дополнительных действий.

### 4.5 Вычислительная сложность
- **Время:** `O(N × M)`
- **Память:** `O(M)`

---

## 5. Параллельная реализация (MPI)

### 5.1 Общая идея
Матрица распределяется по строкам между MPI-процессами.  
Каждый процесс вычисляет локальные суммы столбцов, после чего выполняется коллективная редукция (`MPI_Allreduce`).

---

### 5.2 Валидация
Выполняется только на процессе с рангом `0`:
- проверяется одинаковая длина строк;
- проверяется, что выходной вектор пуст.

Результат валидации рассылается всем процессам с помощью `MPI_Bcast`.

---

### 5.3 Предобработка
- Определяется наличие данных и количество столбцов.
- Эти параметры передаются всем процессам.
- Выходной вектор инициализируется нулями одинакового размера на всех процессах.

---

### 5.4 Распределение данных
1. Матрица на процессе `0` преобразуется в одномерный массив.
2. Рассчитываются:
   - `send_counts` — количество элементов для каждого процесса;
   - `displacements` — смещения в массиве.
3. Данные распределяются с помощью `MPI_Scatterv`.

Распределение строк выполняется равномерно с учётом остатка.

---

### 5.5 Локальные вычисления
Каждый процесс:
- вычисляет суммы столбцов для своей части строк;
- формирует локальный вектор сумм.

---

### 5.6 Сбор результатов
- Локальные суммы объединяются с помощью `MPI_Allreduce` с операцией `MPI_SUM`.
- В результате каждый процесс получает итоговый вектор сумм по столбцам.

---

### 5.7 Вычислительная сложность
- **Время:** `O((N × M) / P)`
- **Память:** `O(M)` на процесс  
где `P` — количество MPI-процессов.

---

## 6. Тестирование

### 6.1 Функциональные тесты
Реализованы с использованием Google Test и включают:
- матрицы размеров `1×1`, `1×N`, `N×1`;
- матрицы с отрицательными значениями;
- матрицы с нулевыми значениями;
- матрицы с большими значениями;
- пустую матрицу.

Результаты MPI- и SEQ-реализаций сравниваются с эталонными значениями.

---

### 6.2 Тесты на некорректные данные
Проверяется, что:
- при различной длине строк валидация возвращает `false`;
- выходной вектор остаётся пустым.

---

### 6.3 Тесты производительности
- Используется квадратная матрица размера `4000 × 4000`.
- Элементы матрицы задаются формулой `i + j`.
- Выполняется сравнение времени выполнения SEQ и MPI реализаций.

---

## 7. Результаты

- Последовательная и параллельная реализации корректно проходят все функциональные тесты.
- MPI-реализация демонстрирует ускорение на больших размерах матриц при увеличении числа процессов.
- Реализация корректно обрабатывает граничные случаи и некорректные входные данные.

---

## 8. Выводы

В ходе лабораторной работы:
- реализован алгоритм суммирования элементов матрицы по столбцам;
- разработаны SEQ и MPI версии алгоритма;
- изучены принципы распределения данных и коллективных операций MPI;
- подтверждена корректность и эффективность параллельного подхода на больших входных данных.

Параллельная реализация позволяет существенно сократить время вычислений по сравнению с последовательной при больших размерах матриц и достаточном количестве процессов.

---
