# Нахождение наиболее отличающихся по значению соседних элементов вектора

-   Student: Швецова Ксения Алексеевна, 3823Б1ФИ1
-   Technology: SEQ, MPI
-   Variant: 8

## 1. Introduction

В рамках данной работы была реализована задача поиска наиболее отличающихся по значению соседних элементов вектора. Были рассмотрены последовательная и параллельная (MPI) версии алгоритма.

## 2. Problem Statement

Дан вектор `v` из `N` элементов. Необходимо найти пару соседних элементов `(v[i], v[i+1])`, для которых модуль разницы `|v[i] - v[i+1]|` максимален.  
**Input:** вектор чисел `v` длиной `N ≥ 0`.  
**Output:** пара соседних элементов с максимальной разницей.  
**Constraints:** если вектор содержит менее двух элементов, результат считается `(0.0, 0.0)`.

## 3. Baseline Algorithm (Sequential)

Последовательная версия алгоритма:

1. Инициализация: `max_diff = 0`, `first_elem = 0`, `second_elem = 0`.
2. Для всех индексов `i = 0..N-2`:
    - `diff = |v[i] - v[i+1]|`
    - Если `diff > max_diff`: обновляем `max_diff`, `first_elem = v[i]`, `second_elem = v[i+1]`.
3. Возвращается пара `(first_elem, second_elem)`.

## 4. Parallelization Scheme

**MPI версия:**

-   **Data distribution:** главный процесс делит вектор на `P` частей:
    -   `base = N / P` — базовое число элементов на процесс
    -   `remain = N % P` — остаток элементов
    -   Первые `remain` процессов получают `base + 1` элементов, остальные — `base`.
-   **Communication pattern:** каждый процесс получает последний элемент предыдущего процесса для проверки разницы на границе.
-   **Rank roles:**
    -   Ранг 0 — главный процесс, собирает все локальные максимумы и определяет глобальный максимум.
    -   Остальные процессы — вычисляют локальные максимумы и обрабатывают границы.

**Пример распределения для 2 процессов и вектора `{1, 2, 100, 3, 4}`:**

-   Процесс 0: `{1, 2, 100}` → локальная максимальная разница: |2-100| = 98
-   Процесс 1: `{100, 3, 4}` → локальная максимальная разница: |100-3| = 97
-   Глобальный максимум: |2-100| = 98 → результат `(2, 100)`

## 5. Implementation Details

-   **Code structure:**
    -   `shvetsova_k_max_diff_neig_vec/seq/include/ops_seq.hpp` — последовательная реализация
    -   `shvetsova_k_max_diff_neig_vec/mpi/include/ops_mpi.hpp` — параллельная реализация MPI
    -   `shvetsova_k_max_diff_neig_vec/common/include/common.hpp` — общие типы данных
-   **Assumptions:** пустой вектор или вектор с одним элементом → результат `(0.0, 0.0)`.
-   **Memory usage:** для MPI версии создаются временные векторы частей и массивы для сбора локальных максимумов, накладные расходы пропорциональны числу процессов.

## 6. Experimental Setup

-   **Hardware/OS:** CPU с 4 ядрами, 16 GB RAM, Ubuntu 22.04
-   **Toolchain:** g++ 12, Release build
-   **Environment:** 4 MPI процесса (`PPC_NUM_PROC=4`)
-   **Data:** генерируются тестовые векторы длиной до 30 000 000 элементов, включая случаи с одной резкой разницей.

## 7. Results and Discussion

### 7.1 Correctness

Функциональные тесты:

-   Вектор с возрастающими числами
-   Вектор с резко отличающимися соседями
-   Вектор с двумя элементами
-   Пустой вектор
-   Случайные значения

Все тесты прошли успешно, результаты совпали с последовательной реализацией.

### 7.2 Performance

| Mode | Count | Time, s | Speedup | Efficiency |
| ---- | ----- | ------- | ------- | ---------- |
| seq  | 1     | 0.468   | 1.00    | N/A        |
| mpi  | 1     | 0.515   | 0.91    | 91.0%      |
| mpi  | 2     | 0.552   | 0.85    | 42.5%      |
| mpi  | 4     | 0.589   | 0.79    | 19.8%      |
| mpi  | 8     | 0.671   | 0.70    | 8.8%       |

**Discussion:** MPI версия медленнее, так как накладные расходы на коммуникацию превышают выигрыш от параллельной обработки. Алгоритм вычислительно легкий, основное время занимает пересылка данных.

## 8. Conclusions

-   Реализованы последовательная и параллельная версии алгоритма поиска пары соседних элементов с максимальной разницей.
-   MPI версия не показала ускорения из-за минимальной вычислительной нагрузки и затрат на коммуникацию.
-   Алгоритм корректно работает для всех тестовых случаев, включая пустой вектор и вектор с одним элементом.

## 9. References

1. Лекции Сысоева Александра Владимировича
2. Практические занятия Нестерова Александра Юрьевича и Оболенского Арсения Андреевича
3. Интернет-ресурсы по MPI и параллельным алгоритмам


